<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Advanced Investment Calculator · Glow‑Up</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #4f46e5; /* indigo */
      --secondary: #06b6d4; /* cyan */
      --accent: #10b981; /* emerald */
      --bg: #0b1020;
      --bg-soft: #0e1429;
      --card: #0f172a;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --ring: rgba(99,102,241,.35);
      --shadow: 0 20px 50px rgba(0,0,0,.35), 0 0 0 1px rgba(99,102,241,.15) inset;
      --radius: 16px;
    }
    body[data-theme="light"]{
      --bg: #eef2f7;
      --bg-soft: #e8eef8;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --ring: rgba(79,70,229,.2);
      --shadow: 0 10px 30px rgba(2,6,23,.08);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 600px at 10% -10%, rgba(79,70,229,.25), transparent 50%),
                  radial-gradient(1000px 500px at 90% 0%, rgba(6,182,212,.25), transparent 50%),
                  linear-gradient(180deg, var(--bg), var(--bg-soft));
      background-attachment: fixed;
      letter-spacing: .1px;
    }

    /* Nav */
    .nav {
      max-width: 1200px; margin: 24px auto 0; padding: 12px 20px;
      display: flex; align-items: center; justify-content: space-between;
      backdrop-filter: blur(10px);
      background: color-mix(in oklab, var(--card) 85%, transparent);
      border: 1px solid color-mix(in oklab, var(--text) 10%, transparent);
      border-radius: 20px; box-shadow: var(--shadow);
    }
    .brand { display:flex; align-items:center; gap:12px; font-weight:800; }
    .logo { width:28px; height:28px; border-radius:8px; background: conic-gradient(from 180deg at 50% 50%, var(--primary), var(--secondary), var(--accent), var(--primary)); box-shadow: 0 0 0 2px rgba(255,255,255,.06) inset; }
    .nav-right { display:flex; align-items:center; gap:10px; }
    .chip { padding:6px 10px; font-size:.85rem; border-radius:999px; color: var(--muted); border:1px solid color-mix(in oklab, var(--text) 10%, transparent); }

    /* Container */
    .container { max-width: 1200px; margin: 18px auto 60px; padding: 22px; }

    /* Hero */
    .hero { padding: 28px; border-radius: var(--radius); background: color-mix(in oklab, var(--card) 90%, transparent); border:1px solid color-mix(in oklab, var(--text) 8%, transparent); box-shadow: var(--shadow); position: relative; overflow: hidden; }
    .hero::after{ content:""; position:absolute; inset:-2px; pointer-events:none; background: radial-gradient(550px 140px at 20% 0%, rgba(99,102,241,.20), transparent 60%), radial-gradient(550px 140px at 80% 0%, rgba(6,182,212,.20), transparent 60%); mask: linear-gradient(#000, transparent 60%); }
    .title { margin: 0 0 6px; font-size: clamp(1.6rem, 2.2vw + .8rem, 2.4rem); font-weight: 800; letter-spacing: .2px; line-height: 1.05; background: linear-gradient(90deg, #ffffff, #c7d2fe, #a7f3d0); -webkit-background-clip: text; background-clip: text; color: transparent; }
    .subtitle { margin: 0; color: var(--muted); font-size: .98rem; }

    /* Layout */
    .grid { display:grid; grid-template-columns: 1.1fr .9fr; gap: 20px; margin-top: 20px; }
    @media (max-width: 980px){ .grid { grid-template-columns: 1fr; } }

    /* Card */
    .card { background: var(--card); border: 1px solid color-mix(in oklab, var(--text) 10%, transparent); border-radius: var(--radius); padding: 18px; box-shadow: var(--shadow); }
    .card h2 { margin: 0 0 14px; font-size: 1.05rem; color: var(--muted); letter-spacing: .3px; font-weight: 700; }

    /* Form */
    form { display:grid; grid-template-columns: repeat(12, 1fr); gap: 14px; }
    .field { grid-column: span 6; display:flex; flex-direction: column; gap: 8px; }
    .field.sm { grid-column: span 4; }
    .field.full { grid-column: 1 / -1; }
    @media (max-width: 720px){ .field, .field.sm { grid-column: 1 / -1; } }

    label { font-size: .88rem; font-weight: 600; color: var(--muted); }
    .control { position: relative; display:flex; align-items:center; }
    .control input, .control select {
      width: 100%; border-radius: 12px; background: color-mix(in oklab, var(--card) 85%, transparent);
      border: 1px solid color-mix(in oklab, var(--text) 12%, transparent);
      padding: 12px 14px; font-size: .98rem; color: var(--text); outline: none; transition: .22s;
    }
    .control input:focus, .control select:focus { border-color: var(--primary); box-shadow: 0 0 0 4px var(--ring); background: color-mix(in oklab, var(--card) 95%, transparent); }
    .hint { font-size: .8rem; color: var(--muted); }

    .btn {
      display:inline-flex; align-items:center; justify-content:center; gap:10px; padding: 14px 16px; border-radius: 12px; border: 1px solid color-mix(in oklab, var(--text) 10%, transparent);
      background: linear-gradient(120deg, color-mix(in oklab, var(--primary) 90%, #fff 10%), color-mix(in oklab, var(--secondary) 75%, #fff 25%));
      color: #fff; font-weight: 800; letter-spacing:.2px; cursor: pointer; box-shadow: 0 14px 30px rgba(79,70,229,.25);
      transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;
    }
    .btn:hover { transform: translateY(-2px); filter: brightness(1.03); box-shadow: 0 18px 40px rgba(79,70,229,.32); }
    .btn.secondary { background: linear-gradient(120deg, color-mix(in oklab, var(--accent) 80%, #fff 20%), color-mix(in oklab, var(--secondary) 70%, #fff 30%)); }
    .btn.ghost { background: transparent; color: var(--text); border-style: dashed; }

    /* KPIs */
    .kpis { display:grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-top: 12px; }
    .kpi { background: color-mix(in oklab, var(--card) 92%, transparent); border:1px solid color-mix(in oklab, var(--text) 10%, transparent); border-radius: 14px; padding: 14px; }
    .kpi .label { font-size:.75rem; color: var(--muted); }
    .kpi .value { margin-top: 6px; font-size: 1.05rem; font-weight: 800; letter-spacing:.3px; }
    @media (max-width: 980px){ .kpis { grid-template-columns: repeat(2, 1fr); } }

    /* Charts */
    .charts { display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    @media (max-width: 980px){ .charts { grid-template-columns: 1fr; } }
    .chart-card { padding: 14px; border-radius: var(--radius); background: var(--card); border:1px solid color-mix(in oklab, var(--text) 10%, transparent); box-shadow: var(--shadow); }
    canvas { width: 100% !important; height: 320px !important; background: color-mix(in oklab, var(--card) 96%, transparent); border-radius: 12px; }

    /* Table */
    .table-wrap { margin-top: 16px; border-radius: 14px; overflow: hidden; border:1px solid color-mix(in oklab, var(--text) 10%, transparent); box-shadow: var(--shadow); }
    table { width: 100%; border-collapse: collapse; font-size: .95rem; background: var(--card); }
    thead th { background: color-mix(in oklab, var(--card) 85%, #fff 15%); color: var(--muted); font-weight: 700; text-align: right; padding: 12px; }
    tbody td { padding: 12px; border-top: 1px solid color-mix(in oklab, var(--text) 10%, transparent); text-align: right; }
    thead th:first-child, tbody td:first-child { text-align: left; }

    /* Utilities */
    .row { display:flex; gap: 10px; flex-wrap: wrap; }
    .space { height: 10px; }

    /* Toggle */
    .toggle { appearance: none; width: 54px; height: 32px; background: color-mix(in oklab, var(--text) 12%, transparent); border-radius: 999px; position: relative; outline: none; cursor: pointer; transition: .25s; }
    .toggle::after { content:""; position: absolute; top: 4px; left: 4px; width: 24px; height: 24px; border-radius: 50%; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,.25); transition: .25s; }
    .toggle:checked { background: linear-gradient(90deg, var(--primary), var(--secondary)); }
    .toggle:checked::after { transform: translateX(22px); }

    .footer { max-width:1200px; margin: 26px auto 40px; padding: 0 22px; color: var(--muted); font-size: .85rem; }
    .footer a { color: inherit; }
  </style>
</head>
<body data-theme="dark">
  <nav class="nav">
    
    <div class="nav-right">
      
      <label class="chip" title="Toggle light/dark">
        <input id="themeToggle" class="toggle" type="checkbox" />
      </label>
    </div>
  </nav>

  <main class="container">
    <section class="hero">
      <h1 class="title">Advanced Investment Calculator</h1>
      <div class="space"></div>
      <div class="grid">
        <div class="card">
          <h2>Inputs</h2>
          <form id="calculator-form">
            <div class="field">
              <label for="initial">Initial Investment ($)</label>
              <div class="control"><input type="number" id="initial" min="0" placeholder="e.g., 2000" required></div>
              <div class="hint">What you start with on day 0.</div>
            </div>

            <div class="field">
              <label for="monthly">Monthly Contribution ($)</label>
              <div class="control"><input type="number" id="monthly" min="0" placeholder="e.g., 250" required></div>
              <div class="hint">Auto‑invested at the end of each month.</div>
            </div>

            <div class="field sm">
              <label for="rate">Annual Interest Rate (%)</label>
              <div class="control"><input type="number" step="0.01" id="rate" min="0" placeholder="e.g., 8" required></div>
            </div>

            <div class="field sm">
              <label for="years">Investment Duration (Years)</label>
              <div class="control"><input type="number" id="years" min="1" placeholder="e.g., 20" required></div>
            </div>

            <div class="field sm">
              <label for="compound">Compound Frequency</label>
              <div class="control">
                <select id="compound">
                  <option value="1">Annually</option>
                  <option value="4">Quarterly</option>
                  <option value="12" selected>Monthly</option>
                  <option value="365">Daily</option>
                </select>
              </div>
            </div>

            <div class="field sm">
              <label for="inflation">Inflation Rate (%)</label>
              <div class="control"><input type="number" step="0.01" id="inflation" min="0" placeholder="e.g., 3" value="0"></div>
            </div>

            <div class="field sm">
              <label for="contribIncrease">Annual Contribution Increase (%)</label>
              <div class="control"><input type="number" step="0.01" id="contribIncrease" min="0" value="0" placeholder="e.g., 2"></div>
            </div>

            <div class="field sm">
              <label for="borrowed">Borrowed Amount (Leverage) ($)</label>
              <div class="control"><input type="number" id="borrowed" min="0" value="0" placeholder="0 if none"></div>
            </div>

            <div class="field sm">
              <label for="borrowedRate">Interest on Borrowed (%)</label>
              <div class="control"><input type="number" step="0.01" id="borrowedRate" min="0" value="0" placeholder="e.g., 5"></div>
            </div>

            <div class="field sm">
              <label for="leverageFrequency">Leverage Frequency</label>
              <div class="control">
                <select id="leverageFrequency">
                  <option value="once" selected>Once at Start</option>
                  <option value="monthly">Monthly</option>
                  <option value="yearly">Yearly</option>
                </select>
              </div>
            </div>

            <div class="field full row">
              <button type="submit" class="btn" id="calcBtn"> Calculate Investment</button>
              <button type="button" class="btn secondary" id="demoBtn"> Quick Demo Values</button>
              <button type="button" class="btn ghost" id="exportBtn"> Export Table (CSV)</button>
            </div>
          </form>
        </div>

        <div class="card">
          <h2>Results</h2>
          <div class="kpis" id="kpis">
            <div class="kpi"><div class="label">Total Future Value</div><div class="value" id="kpiFuture">—</div></div>
            <div class="kpi"><div class="label">Inflation‑Adjusted</div><div class="value" id="kpiReal">—</div></div>
            <div class="kpi"><div class="label">Total Contributions</div><div class="value" id="kpiContrib">—</div></div>
            <div class="kpi"><div class="label">Borrow Interest Paid</div><div class="value" id="kpiDebt">—</div></div>
            <div class="kpi"><div class="label">Net Interest Earned</div><div class="value" id="kpiNet">—</div></div>
          </div>
          <div class="space"></div>
          <div class="charts">
            <div class="chart-card"><canvas id="barChart"></canvas></div>
            <div class="chart-card"><canvas id="pieChart"></canvas></div>
          </div>
        </div>
      </div>

      <div class="space"></div>
      <div class="card">
        <h2>Accumulation Schedule</h2>
        <div class="table-wrap">
          <table id="accumulationTable">
            <thead>
              <tr><th>Year</th><th>Deposit</th><th>Interest</th><th>Borrow Interest</th><th>Ending Balance</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>


  <script>
    // Theme toggle (persisted)
    const themeToggle = document.getElementById('themeToggle');
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) document.body.setAttribute('data-theme', savedTheme);
    themeToggle.checked = document.body.getAttribute('data-theme') === 'light';
    themeToggle.addEventListener('change', () => {
      const next = themeToggle.checked ? 'light' : 'dark';
      document.body.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    });

    // Shorthand formatters
    const money = (n) => (isFinite(n) ? n : 0).toLocaleString(undefined, { style: 'currency', currency: 'USD', maximumFractionDigits: 2 });

    const form = document.getElementById('calculator-form');
    const tbody = document.querySelector('#accumulationTable tbody');
    const kpiFuture = document.getElementById('kpiFuture');
    const kpiReal = document.getElementById('kpiReal');
    const kpiContrib = document.getElementById('kpiContrib');
    const kpiDebt = document.getElementById('kpiDebt');
    const kpiNet = document.getElementById('kpiNet');

    const demoBtn = document.getElementById('demoBtn');
    const exportBtn = document.getElementById('exportBtn');

    let barChart, pieChart;

    demoBtn.addEventListener('click', () => {
      document.getElementById('initial').value = 2000;
      document.getElementById('monthly').value = 250;
      document.getElementById('rate').value = 8;
      document.getElementById('years').value = 20;
      document.getElementById('compound').value = 12;
      document.getElementById('inflation').value = 3;
      document.getElementById('contribIncrease').value = 2;
      document.getElementById('borrowed').value = 0;
      document.getElementById('borrowedRate').value = 0;
      document.getElementById('leverageFrequency').value = 'once';
    });

    exportBtn.addEventListener('click', () => {
      const rows = [['Year','Deposit','Interest','Borrow Interest','Ending Balance']];
      document.querySelectorAll('#accumulationTable tbody tr').forEach(tr => {
        const cells = Array.from(tr.children).map(td => td.textContent.replace(/[$,]/g, ''));
        rows.push(cells);
      });
      const csv = rows.map(r => r.join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'accumulation_schedule.csv'; a.click();
      URL.revokeObjectURL(url);
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const initial = parseFloat(document.getElementById('initial').value) || 0;
      const borrowed = parseFloat(document.getElementById('borrowed').value) || 0;
      const borrowedRate = (parseFloat(document.getElementById('borrowedRate').value) || 0) / 100;
      const monthly = parseFloat(document.getElementById('monthly').value) || 0;
      const rate = (parseFloat(document.getElementById('rate').value) || 0) / 100;
      const years = parseInt(document.getElementById('years').value) || 0;
      const compound = parseInt(document.getElementById('compound').value) || 12; // reserved for future refinement
      const inflation = (parseFloat(document.getElementById('inflation').value) || 0) / 100;
      const contribIncrease = (parseFloat(document.getElementById('contribIncrease').value) || 0) / 100;
      const leverageFrequency = document.getElementById('leverageFrequency').value;

      let balance = initial;
      let monthlyRate = rate / 12;
      let borrowedMonthlyRate = borrowedRate / 12;
      let contribution = monthly;
      let totalContrib = initial;
      let totalBorrowInterest = 0;

      const rows = [], labels = [], interestData = [], contribData = [], endBalanceData = [];

      for (let y = 1; y <= years; y++) {
        let deposit = 0, interest = 0, borrowInterest = 0;

        if (leverageFrequency === 'yearly') {
          balance += borrowed; totalContrib += borrowed;
        }

        for (let m = 0; m < 12; m++) {
          if (leverageFrequency === 'monthly') { balance += borrowed; totalContrib += borrowed; }
          const gain = balance * monthlyRate;
          const debtInterest = borrowed * borrowedMonthlyRate;
          balance += gain + contribution;
          deposit += contribution; interest += gain; borrowInterest += debtInterest;
        }

        if (leverageFrequency === 'once' && y === 1) { balance += borrowed; totalContrib += borrowed; }

        totalContrib += deposit; totalBorrowInterest += borrowInterest;
        rows.push(`<tr><td>${y}</td><td>${money(deposit)}</td><td>${money(interest)}</td><td>${money(borrowInterest)}</td><td>${money(balance)}</td></tr>`);
        labels.push('Year ' + y);
        endBalanceData.push(balance);
        interestData.push(interest - borrowInterest);
        contribData.push(totalContrib);
        contribution *= (1 + contribIncrease);
      }

      const realValue = balance / Math.pow(1 + inflation, years);
      const netInterest = balance - totalContrib - totalBorrowInterest;

      // KPIs
      kpiFuture.textContent = money(balance);
      kpiReal.textContent = money(realValue);
      kpiContrib.textContent = money(totalContrib);
      kpiDebt.textContent = money(totalBorrowInterest);
      kpiNet.textContent = money(netInterest);

      // Table
      tbody.innerHTML = rows.join('');

      // Charts
      const gridText = getComputedStyle(document.body).getPropertyValue('--muted');
      const primary = getComputedStyle(document.body).getPropertyValue('--primary').trim();
      const accent = getComputedStyle(document.body).getPropertyValue('--accent').trim();

      if (barChart) barChart.destroy();
      barChart = new Chart(document.getElementById('barChart').getContext('2d'), {
        type: 'bar',
        data: {
          labels,
          datasets: [
            { label: 'Total Contributions', data: contribData, backgroundColor: primary },
            { label: 'Net Interest', data: interestData, backgroundColor: accent }
          ]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: {
            legend: { labels: { color: gridText } },
            title: { display: true, text: 'Growth Over Time', color: gridText, font: { weight: '700' } },
            tooltip: { callbacks: { label: ctx => `${ctx.dataset.label}: ${money(ctx.parsed.y)}` } }
          },
          scales: {
            x: { ticks: { color: gridText }, grid: { color: 'rgba(148,163,184,.15)' } },
            y: { ticks: { color: gridText, callback: val => money(val) }, grid: { color: 'rgba(148,163,184,.15)' } }
          }
        }
      });

      if (pieChart) pieChart.destroy();
      pieChart = new Chart(document.getElementById('pieChart').getContext('2d'), {
        type: 'doughnut',
        data: {
          labels: ['Starting Amount', 'Additional Contributions', 'Net Interest'],
          datasets: [{
            data: [initial, Math.max(totalContrib - initial - borrowed, 0), netInterest],
            backgroundColor: ['#06b6d4', primary, accent]
          }]
        },
        options: {
          responsive: true, maintainAspectRatio: false,
          plugins: {
            legend: { labels: { color: gridText } },
            title: { display: true, text: 'Portfolio Breakdown', color: gridText, font: { weight: '700' } },
            tooltip: { callbacks: { label: ctx => `${ctx.label}: ${money(ctx.parsed)} ` } }
          }
        }
      });
    });
  </script>
</body>
</html>
